---
title: Weather Application
slug: weather-app
repoLink: 'https://github.com/JorgeAMendoza/react-weather-app'
demoLink: 'https://react-weather-app-tau-two.vercel.app/'
video:
  {
    poster: '/project-images/weather-app/poster.webp',
    webm: '/project-images/weather-app/weather.webm',
    mp4: '/project-images/weather-app/weather.mp4',
  }
tableOfContents:
  [
    { sectionID: 'Introduction' },
    { sectionID: 'Previous Attempt' },
    { sectionID: 'techstack-used' },
    {
      sectionID: 'Development and Improvement',
      subSections:
        [
          'Fetching Weather Data',
          'Query State Management',
          'Vercel Serverless Function',
        ],
    },
    { sectionID: 'Conclusion' },
  ]
tools: ['react', 'typescript', 'react-query', 'styled-components', 'cypress']
---

## Introduction

The goal of the project is to create a functioning, web-based weather application that allows users to search for the current weather and the five-day forecast of a specific city around the world.

Three goals I aimed to achieve with this project include:

1. Use servless functions to act as a proxy between the application and API to ensure that no API keys are exposed through client.
2. Thoroughly test the application to ensure no errors are deployed.
3. Make the application accessible as possible, ensuring that those with disablities can easily search for the weather as well.

## Previous Attempt

The application was previously built using basic react with no TypeScript. After improving my skills and working on multiple projects, I decided to revisit the project and improve upon it with the new skills and tools I have learned up to this point. You can find the original version of the project under the branch titled ["app-version-1"](https://github.com/JorgeAMendoza/react-weather-app/tree/app-version-1)

The API used to retrieve weather is provided by [OpenWeather](https://openweathermap.org/api), both versions of the application use the 2.0 version of the One Call API. Sadly, **Version 2.0 of the the API can no longer be signed up for**, which I found easier to use than the latest version.

Three improvements I wanted to focus on were:

1. Fetching and handling data more efficiently with state-management tools.
2. Component structure and project organization, I wanted to make it clear anybody skimmming through the repository how the component worked and why it was structured like so.
3. Improved use of the styled-components library.

## Techstack Used

This Project is bootstrapped with [Vite](https://vitejs.dev/guide/) using the React/Typescript template. The project is linted with [Eslint](https://eslint.org/docs/latest/user-guide/getting-started) using react, prettier, cypress, and the [jsx-a11y](https://github.com/jsx-eslint/eslint-plugin-jsx-a11y) rules.

The following are the main tools used to create the application:

- [React](https://reactjs.org/docs/getting-started.html), a JavaScript library for building user interfaces.
- [Tanstack Query](https://tanstack.com/query/v4/docs/react/overview), a state management tools for queries made in the application.
- [Cypress](https://docs.cypress.io/guides/overview/why-cypress#What-you-ll-learn), front end testing tool for writing unit and integration test.

Other libraries used include [axios](https://www.npmjs.com/package/axios) which is a HTTP client for the browser and node.js, and [react-hook-form](https://react-hook-form.com/get-started) which is state-management tool for building and managing form state.

## Development and Improvement

The project originally started when I was taking an online course provided by [The Odin Project](https://www.theodinproject.com/lessons/node-path-javascript-weather-app), where I was tasked to create a weather application using an API. At the time I was just getting into React, so I decided it would be a great opportunity to build a functional React application for the first time. The original version of the application was bootstrapped with [create-react-app](https://create-react-app.dev/).

A year later, when I revisited the project, I found that there are multiple improvements that can be made within the project. One of the biggest changes was switching over to Vite from Create-React-App. This was done since I found Vite much easier and efficient to use and easier to configure, and because also that create-react-app was no longer being maintained.

This section will review some of biggest changes I made to the application and why they were made.

### Fetching Weather Data

I orginally structured the application so that one API call would be made and the results would be passed down to the various components that needed to display data. I attempted to create a presentional/container component structure. So `App.js` would be in charge of holidng multiple instances of state and calling a function that retrives weather data and set the values of multiple states. This data would then be passed down to components to be displayed. The implementation of this can be found in the [`App.tsx`](https://github.com/JorgeAMendoza/react-weather-app/blob/app-version-1/src/app/App.js) in teh `app-version-1` branch.

Some issues I have wite this approach include:

1. **Too many instances of state**, there are multiple instances of state that are not needed. For example, the `searchLocation` state is only used to display the location of the weather data, but the data is already stored in the `currentWeather` state. The `searchQuery` state is only used to make the API call, but the data is already stored in the `currentWeather` state.
2. **Weather data fetch lives in component**, on every re-render we are creating the function again, the function should be able to live outside the component, taking in a search query and returning the data needed.
3. **Error handling**, there is no direct error handling, errors are caught with `.catch()` but all it does is set a message.
4. **Exposed API**, in the orginal verion of the application the API key was being exposed with every request because the key is was part of the query.

### Query State Management

Using tanstack query, the `useQuery` hook can handle the state of the request made based on the props and configuration passed in. If a user searches for invalid data, instead of removing the last successful search, the hook ensures that the previous search data stays on page. When a user enters a query that was already made, instead of making the request to the api, cached results of the request are displayed. The hook can be found in the [`App.tsx`](https://github.com/JorgeAMendoza/react-weather-app/blob/main/src/App.tsx#L16-L36) component.

Some options passed into the hook include:

- A query will not be made if the user focuses back on the page.
- If the query fails, the previous data will be used instead.
- Using a try/catch block in the query function, an error message is set on an error.

### Vercel Serverless Function

Instead of directly sending request to the Open Weather API, a Vercel Serverless function is used which acts as a proxy for the request and returns the results from the API to the browser. The API key now lives on the serverless function and not on the client, which ensures that the API key is not exposed to the public. The implementation of this function can be found in the [`weather.js`](https://github.com/JorgeAMendoza/react-weather-app/blob/main/api/weather.js) file.

Arrays were created that are used to properly structure the dates and days of the week. Following a _transition layer_ philosophy, the function retrieves the data and structures it in a way that makes it easier for one to extract the data and pass it into the right components.

### Typescript

Using Typescript, the results of the query function, its properties, and error can be typed to avoid mistakenly grabbing values that do not exist or avoid grabbing a potentially undefined object. The API response is typed as well to ensure that the data is extracted correctly.

All type information can be found in the [`api.ts`](https://github.com/JorgeAMendoza/react-weather-app/blob/main/src/types/api.ts) file.

### Derived State

Instead of extracting the forecast and current weather data from the query response and setting that to another state, the `const` variable [`weatherData`](https://github.com/JorgeAMendoza/react-weather-app/blob/main/src/App.tsx#L38-L52) is created which gets the result of the `useMemo` callback which takes in the passed in weather data and converts it to the right unit based on the `unit` property. The `useMemo` hook is used because I only wanted this value to change only if the `unit` was modified. The `weatherData` object is passed to the `CurrentWeather` and `Forecast` components.

`useMemo` is used to avoid uncessarily executing the function when it is not required. In the original version of the application, any state change made caused the function run, even if the state change did not affect the function. Though the original implemetation did not cause major performance issues, it is still a good practice to avoid uncessary function calls.

### Cypress Testing

End-to-end test were created using the Cypress testing library. When a test makes an API request, instead of directly contacting the API (variable response time and data), the request is intercepted and a fixture is returned which contains "fake" weather data to insert. I wanted to these test focus on the client user-intercation rather than the API response itself. All `.json` fixture files can be found in the [`/cypress/fixtures`](https://github.com/JorgeAMendoza/react-weather-app/tree/main/cypress/fixtures) directory.

The `page-load.cy.ts`(https://github.com/JorgeAMendoza/react-weather-app/blob/main/cypress/e2e/page-load.cy.ts#L3-L41) file contains the test suite for tests that check if the application rendered proerly on the page for the first request. `cy.intercept` is the method that ensures that the request is intercepted and the fixture is returned. Each test file will contain its own intercept, with one requesting for another city and another attempting a bad search.

### Styled Components

Like in the original version of the application, Styled Components is used here as well. Instead of creating multiple styled components and importing them into the component, an object containing all the styled components is default exported and imported into the component. This avoids importing multiple components into the object which allows for cleaner code. An example of this can be found in the [`CurrentWeather.styled.tsx`](https://github.com/JorgeAMendoza/react-weather-app/blob/main/src/components/CurrentWeather/CurrentWeather.styled.tsx) component. The component exports one object, and the `CurrentWeather` component uses the name `Styled` to access the styled components.

## Conclusion

It was refreshing to go back to the original version, examine what should be improved, and implement those changes. There are still other improvements that could be made to this application, but in its current state it is something I can be proud of. If you find any issues with the application, please visit the GitHub repo page and create an issue.
